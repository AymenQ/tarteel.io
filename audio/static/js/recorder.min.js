(function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?this:self:global:window,b.Recorder=a()}})(function(){return function b(c,d,e){function a(h,i){if(!d[h]){if(!c[h]){var j="function"==typeof require&&require;if(!i&&j)return j(h,!0);if(g)return g(h,!0);var k=new Error("Cannot find module '"+h+"'");throw k.code="MODULE_NOT_FOUND",k}var f=d[h]={exports:{}};c[h][0].call(f.exports,function(b){var d=c[h][1][b];return a(d?d:b)},f,f.exports,b,c,d,e)}return d[h].exports}for(var g="function"==typeof require&&require,f=0;f<e.length;f++)a(e[f]);return a}({1:[function(a,b){"use strict";b.exports=a("./recorder").Recorder},{"./recorder":2}],2:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();Object.defineProperty(c,"__esModule",{value:!0}),c.Recorder=void 0;var f=a("inline-worker"),g=function(a){return a&&a.__esModule?a:{default:a}}(f),h=c.Recorder=function(){function a(b,c){var f=this;d(this,a),this.config={bufferLen:4096,numChannels:2,mimeType:"audio/wav"},this.recording=!1,this.callbacks={getBuffer:[],exportWAV:[]},Object.assign(this.config,c),this.context=b.context,this.node=(this.context.createScriptProcessor||this.context.createJavaScriptNode).call(this.context,this.config.bufferLen,this.config.numChannels,this.config.numChannels),this.node.onaudioprocess=function(a){if(f.recording){for(var b=[],c=0;c<f.config.numChannels;c++)b.push(a.inputBuffer.getChannelData(c));f.worker.postMessage({command:"record",buffer:b})}},b.connect(this.node),this.node.connect(this.context.destination);var e={};this.worker=new g.default(function(){function a(a){m=a.sampleRate,n=a.numChannels,g()}function b(a){for(var b=0;b<n;b++)p[b].push(a[b]);o+=a[0].length}function c(a){for(var b=[],c=0;c<n;c++)b.push(h(p[c],o));var d=2===n?i(b[0],b[1]):b[0];var f=l(d),g=new Blob([f],{type:a});e.postMessage({command:"exportWAV",data:g})}function d(){for(var a=[],b=0;b<n;b++)a.push(h(p[b],o));e.postMessage({command:"getBuffer",data:a})}function f(){o=0,p=[],g()}function g(){for(var a=0;a<n;a++)p[a]=[]}function h(a,b){for(var c=new Float32Array(b),d=0,e=0;e<a.length;e++)c.set(a[e],d),d+=a[e].length;return c}function i(a,b){for(var c=a.length+b.length,d=new Float32Array(c),e=0,f=0;e<c;)d[e++]=a[f],d[e++]=b[f],f++;return d}function j(a,b,c){for(var d,e=0;e<c.length;e++,b+=2)d=Math.max(-1,Math.min(1,c[e])),a.setInt16(b,0>d?32768*d:32767*d,!0)}function k(a,b,c){for(var d=0;d<c.length;d++)a.setUint8(b+d,c.charCodeAt(d))}function l(a){var b=new ArrayBuffer(44+2*a.length),c=new DataView(b);return k(c,0,"RIFF"),c.setUint32(4,36+2*a.length,!0),k(c,8,"WAVE"),k(c,12,"fmt "),c.setUint32(16,16,!0),c.setUint16(20,1,!0),c.setUint16(22,n,!0),c.setUint32(24,m,!0),c.setUint32(28,4*m,!0),c.setUint16(32,2*n,!0),c.setUint16(34,16,!0),k(c,36,"data"),c.setUint32(40,2*a.length,!0),j(c,44,a),c}var m,n,o=0,p=[];e.onmessage=function(g){switch(g.data.command){case"init":a(g.data.config);break;case"record":b(g.data.buffer);break;case"exportWAV":c(g.data.type);break;case"getBuffer":d();break;case"clear":f();}}},e),this.worker.postMessage({command:"init",config:{sampleRate:this.context.sampleRate,numChannels:this.config.numChannels}}),this.worker.onmessage=function(a){var b=f.callbacks[a.data.command].pop();"function"==typeof b&&b(a.data.data)}}return e(a,[{key:"record",value:function(){this.recording=!0}},{key:"stop",value:function(){this.recording=!1}},{key:"clear",value:function(){this.worker.postMessage({command:"clear"})}},{key:"getBuffer",value:function(a){if(a=a||this.config.callback,!a)throw new Error("Callback not set");this.callbacks.getBuffer.push(a),this.worker.postMessage({command:"getBuffer"})}},{key:"exportWAV",value:function(a,b){if(b=b||this.config.mimeType,a=a||this.config.callback,!a)throw new Error("Callback not set");this.callbacks.exportWAV.push(a),this.worker.postMessage({command:"exportWAV",type:b})}}],[{key:"forceDownload",value:function(a,b){var c=(window.URL||window.webkitURL).createObjectURL(a),d=window.document.createElement("a");d.href=c,d.download=b||"output.wav";var e=document.createEvent("Event");e.initEvent("click",!0,!0),d.dispatchEvent(e)}}]),a}();c.default=h},{"inline-worker":3}],3:[function(a,b){"use strict";b.exports=a("./inline-worker")},{"./inline-worker":4}],4:[function(a,b){(function(a){"use strict";var c=function(){function a(a,b){for(var c in b){var d=b[c];d.configurable=!0,d.value&&(d.writable=!0)}Object.defineProperties(a,b)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),d=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},e=!!(a===a.window&&a.URL&&a.Blob&&a.Worker),f=function(){function b(c,f){var g=this;if(d(this,b),e){var h=c.toString().trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1],i=a.URL.createObjectURL(new a.Blob([h],{type:"text/javascript"}));return new a.Worker(i)}this.self=f,this.self.postMessage=function(a){setTimeout(function(){g.onmessage({data:a})},0)},setTimeout(function(){c.call(f)},0)}return c(b,{postMessage:{value:function(a){var b=this;setTimeout(function(){b.self.onmessage({data:a})},0)}}}),b}();b.exports=f}).call(this,"undefined"==typeof global?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:global)},{}]},{},[1])(1)});
