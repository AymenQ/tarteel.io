(function(a){'use strict';var b,c=Array.prototype.slice;b=function(c){this.options=a.extend({},b.defaults,c),this.parser=this.options.parser,this.locale=this.options.locale,this.messageStore=this.options.messageStore,this.languages={}},b.prototype={localize:function(b){var c,d,e,f,g,h;for(e=this.locale,f=0;e;){c=e.split('-'),d=c.length;do{if(g=c.slice(0,d).join('-'),h=this.messageStore.get(g,b),h)return h;d--}while(d);if('en'===e)break;e=a.i18n.fallbacks[this.locale]&&a.i18n.fallbacks[this.locale][f]||this.options.fallbackLocale,a.i18n.log('Trying fallback locale for '+this.locale+': '+e+' ('+b+')'),f++}return''},destroy:function(){a.removeData(document,'i18n')},load:function(b,c){var d,e,f,g={};if(b||c||(b='i18n/'+a.i18n().locale+'.json',c=a.i18n().locale),'string'==typeof b&&'json'!==b.split('?')[0].split('.').pop()){for(g[c]=b+'/'+c+'.json',d=(a.i18n.fallbacks[c]||[]).concat(this.options.fallbackLocale),e=0;e<d.length;e++)f=d[e],g[f]=b+'/'+f+'.json';return this.load(g)}return this.messageStore.load(b,c)},parse:function(b,c){var d=this.localize(b);return this.parser.language=a.i18n.languages[a.i18n().locale]||a.i18n.languages['default'],''===d&&(d=b),this.parser.parse(d,c)}},a.i18n=function(d,e){var f,g=a.data(document,'i18n'),h='object'==typeof d&&d;return h&&h.locale&&g&&g.locale!==h.locale&&(g.locale=h.locale),g||(g=new b(h),a.data(document,'i18n',g)),'string'==typeof d?(f=void 0===e?[]:c.call(arguments,1),g.parse(d,f)):g},a.fn.i18n=function(){var c=a.data(document,'i18n');return c||(c=new b,a.data(document,'i18n',c)),this.each(function(){var b,d,e,f,g=a(this),h=g.data('i18n');h?(b=h.indexOf('['),d=h.indexOf(']'),-1!==b&&-1!==d&&b<d?(e=h.slice(b+1,d),f=h.slice(d+1),'html'===e?g.html(c.parse(f)):g.attr(e,c.parse(f))):g.html(c.parse(h))):g.find('[data-i18n]').i18n()})},a.i18n.languages={},a.i18n.messageStore=a.i18n.messageStore||{},a.i18n.parser={parse:function(a,b){return a.replace(/\$(\d+)/g,function(a,c){var d=parseInt(c,10)-1;return b[d]===void 0?'$'+c:b[d]})},emitter:{}},a.i18n.fallbacks={},a.i18n.debug=!1,a.i18n.log=function(){window.console&&a.i18n.debug&&window.console.log.apply(window.console,arguments)},b.defaults={locale:function(){var b=a('html').attr('lang');return b||(b=navigator.language||navigator.userLanguage||''),b}(),fallbackLocale:'en',parser:a.i18n.parser,messageStore:a.i18n.messageStore},a.i18n.constructor=b})(jQuery);
